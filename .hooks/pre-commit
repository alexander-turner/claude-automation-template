#!/bin/bash
# Pre-commit hook: Format and lint staged files
# Customize the lint-staged configuration in package.json

set -euo pipefail

git_root=$(git rev-parse --show-toplevel)

# Git hooks run in a separate shell and don't inherit CLAUDE_ENV_FILE modifications.
# Explicitly add .venv/bin to PATH so Python tools from uv are available.
if [ -d "$git_root/.venv/bin" ]; then
  export PATH="$git_root/.venv/bin:$PATH"
fi

# Check if lint-staged is installed
if [ ! -f "$git_root/node_modules/.bin/lint-staged" ]; then
  echo "Warning: lint-staged not found. Run 'pnpm install' to enable pre-commit formatting." >&2
  exit 0
fi

# Run lint-staged (via pnpm or npm)
if command -v pnpm >/dev/null 2>&1; then
  pnpm exec lint-staged --allow-empty
elif command -v npm >/dev/null 2>&1; then
  npx lint-staged --allow-empty
else
  echo "Warning: Neither pnpm nor npm found. Skipping lint-staged." >&2
fi
