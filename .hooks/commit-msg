#!/bin/bash
# Commit message hook: Validate conventional commit format
# Uses commitlint with @commitlint/config-conventional

set -euo pipefail

git_root="$(git rev-parse --show-toplevel)"

# Git hooks run in a separate shell and don't inherit CLAUDE_ENV_FILE modifications.
# Explicitly add .venv/bin to PATH so Python tools from uv are available.
if [ -d "$git_root/.venv/bin" ]; then
  export PATH="$git_root/.venv/bin:$PATH"
fi

# Run commitlint if available via pnpm or npm
if command -v pnpm >/dev/null 2>&1 && [ -f "$git_root/node_modules/.bin/commitlint" ]; then
  pnpm exec commitlint --edit "$1" --config config/javascript/commitlint.config.js
elif command -v npm >/dev/null 2>&1 && [ -f "$git_root/node_modules/.bin/commitlint" ]; then
  npx commitlint --edit "$1" --config config/javascript/commitlint.config.js
fi
